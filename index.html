<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ç´…åŒ…å¤§æŒ‘æˆ° - æ˜¥ç¯€æ——è‰¦æœ€çµ‚ç‰ˆ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700;900&display=swap');
        
        :root {
            --chinese-red: #bd081c;
            --premium-gold: linear-gradient(to bottom, #fff3b0 0%, #f6e05e 40%, #d4af37 100%);
            --dark-gold: #b8860b;
        }

        body {
            font-family: 'Noto Sans TC', sans-serif;
            background-color: #7a0000;
            background-image: url("data:image/svg+xml,%3Csvg width='52' height='26' viewBox='0 0 52 26' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23960000' fill-opacity='0.4'%3E%3Cpath d='M10 10c0-2.21-1.79-4-4-4-3.314 0-6-2.686-6-6h2c0 2.21 1.79 4 4 4 3.314 0 6 2.686 6 6 0 2.21 1.79 4 4 4h2c-2.21 0-4-1.79-4-4zm20 0c0-2.21-1.79-4-4-4-3.314 0-6-2.686-6-6h2c0 2.21 1.79 4 4 4 3.314 0 6 2.686 6 6 0 2.21 1.79 4 4 4h2c-2.21 0-4-1.79-4-4zM80 10c0-2.21-1.79-4-4-4-3.314 0-6-2.686-6-6h2c0 2.21 1.79 4 4 4 3.314 0 6 2.686 6 6 0 2.21 1.79 4 4 4h2c-2.21 0-4-1.79-4-4zM40 30c0-2.21-1.79-4-4-4-3.314 0-6-2.686-6-6h2c0 2.21 1.79 4 4 4 3.314 0 6 2.686 6 6 0 2.21 1.79 4 4 4h2c-2.21 0-4-1.79-4-4zM60 30c0-2.21-1.79-4-4-4-3.314 0-6-2.686-6-6h2c0 2.21 1.79 4 4 4 3.314 0 6 2.686 6 6 0 2.21 1.79 4 4 4h2c-2.21 0-4-1.79-4-4zM10 50c0-2.21-1.79-4-4-4-3.314 0-6-2.686-6-6h2c0 2.21 1.79 4 4 4 3.314 0 6 2.686 6 6 0 2.21 1.79 4 4 4h2c-2.21 0-4-1.79-4-4zm20 0c0-2.21-1.79-4-4-4-3.314 0-6-2.686-6-6h2c0 2.21 1.79 4 4 4 3.314 0 6 2.686 6 6 0 2.21 1.79 4 4 4h2c-2.21 0-4-1.79-4-4z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
            touch-action: manipulation;
        }

        .bg-red-luxury {
            background: linear-gradient(145deg, #e62222 0%, #8b0000 100%);
            border: 4px solid #f6e05e;
            box-shadow: 0 30px 80px rgba(0,0,0,0.6);
            position: relative;
        }

        /* ç‡™é‡‘æ•ˆæœæ¨™é¡Œ */
        .title-gold {
            background: var(--premium-gold);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            filter: drop-shadow(0 2px 0px rgba(139, 0, 0, 0.8)) drop-shadow(0 4px 10px rgba(0,0,0,0.5));
            letter-spacing: 0.1em;
        }

        .scratch-container {
            position: relative;
            width: 300px;
            height: 180px;
            margin: 0 auto;
            background: #fff;
            border-radius: 1.5rem;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: inset 0 0 40px rgba(0,0,0,0.3);
            border: 6px solid #f6e05e;
        }

        #scratch-canvas {
            position: absolute;
            top: 0;
            left: 0;
            touch-action: none;
            cursor: none; 
        }

        .lantern {
            position: absolute;
            width: 45px;
            animation: sway 4s ease-in-out infinite alternate;
            transform-origin: top center;
            filter: drop-shadow(0 8px 15px rgba(0,0,0,0.6));
            z-index: 50;
        }
        @keyframes sway {
            from { transform: rotate(-6deg); }
            to { transform: rotate(6deg); }
        }

        #reward-notice {
            position: fixed;
            top: 83%; 
            left: 50%;
            width: 220vw; 
            transform: translate(-50%, -50%) rotate(-3deg);
            background: #f6e05e;
            border-top: 5px solid #8b0000;
            border-bottom: 5px solid #8b0000;
            box-shadow: 0 0 50px rgba(0,0,0,0.5);
            z-index: 200;
            pointer-events: none;
            overflow: hidden;
            padding: 10px 0;
        }
        .marquee-wrap {
            display: flex;
            width: fit-content;
            animation: marquee 10s linear infinite; 
        }
        .marquee-content {
            flex-shrink: 0;
            padding: 0 60px;
            white-space: nowrap;
            font-size: 2.4rem;
            font-weight: 900;
            color: #8b0000;
            text-shadow: 1px 1px 0px rgba(255,255,255,0.7);
            animation: soft-blink 1.5s ease-in-out infinite;
        }
        @keyframes soft-blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        @keyframes marquee {
            0% { transform: translateX(0); }
            100% { transform: translateX(-50%); } 
        }
        
        .home-icon-btn {
            position: absolute;
            top: -15px;
            left: -15px;
            background: linear-gradient(to bottom, #fff3b0, #f6e05e);
            color: #8b0000;
            width: 55px;
            height: 55px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 8px 20px rgba(0,0,0,0.5);
            z-index: 210;
            border: 3px solid #8b0000;
        }
        .home-icon-btn:active { transform: scale(0.9); }

        .btn-gold-3d {
            background: linear-gradient(to bottom, #fff3b0 0%, #f6e05e 50%, #d4af37 100%);
            color: #8b0000;
            border-bottom: 6px solid #b8860b;
            text-shadow: 0 1px 1px rgba(255,255,255,0.5);
            transition: all 0.1s;
        }
        .btn-gold-3d:active {
            transform: translateY(4px);
            border-bottom-width: 2px;
        }
    </style>
</head>
<body class="min-h-screen flex items-center justify-center p-4">

    <!-- é¦–é è£é£¾ -->
    <div id="home-decorations" class="fixed inset-0 pointer-events-none overflow-hidden">
        <div class="lantern top-0 left-4"><svg viewBox="0 0 100 120" fill="#ff4d4d"><ellipse cx="50" cy="55" rx="35" ry="45" /><rect x="35" y="10" width="30" height="5" fill="#ffd700"/><rect x="35" y="95" width="30" height="5" fill="#ffd700"/><rect x="48" y="100" width="4" height="20" fill="#ffd700"/></svg></div>
        <div class="lantern top-[-10px] left-24 opacity-60 scale-75"><svg viewBox="0 0 100 120" fill="#ff4d4d"><ellipse cx="50" cy="55" rx="35" ry="45" /><rect x="35" y="10" width="30" height="5" fill="#ffd700"/><rect x="35" y="95" width="30" height="5" fill="#ffd700"/><rect x="48" y="100" width="4" height="20" fill="#ffd700"/></svg></div>
        <div class="lantern top-0 right-4"><svg viewBox="0 0 100 120" fill="#ff4d4d"><ellipse cx="50" cy="55" rx="35" ry="45" /><rect x="35" y="10" width="30" height="5" fill="#ffd700"/><rect x="35" y="95" width="30" height="5" fill="#ffd700"/><rect x="48" y="100" width="4" height="20" fill="#ffd700"/></svg></div>
        <div class="lantern top-[-15px] right-28 opacity-60 scale-75"><svg viewBox="0 0 100 120" fill="#ff4d4d"><ellipse cx="50" cy="55" rx="35" ry="45" /><rect x="35" y="10" width="30" height="5" fill="#ffd700"/><rect x="35" y="95" width="30" height="5" fill="#ffd700"/><rect x="48" y="100" width="4" height="20" fill="#ffd700"/></svg></div>
    </div>

    <!-- é ˜çè·‘é¦¬ç‡ˆ -->
    <div id="reward-notice" class="hidden">
        <div class="marquee-wrap">
            <div class="marquee-content">ğŸ§§ è«‹æ‰¾å§‘å§‘é ˜çï¼ ğŸ§§</div>
            <div class="marquee-content">ğŸ§§ è«‹æ‰¾å§‘å§‘é ˜çï¼ ğŸ§§</div>
            <div class="marquee-content">ğŸ§§ è«‹æ‰¾å§‘å§‘é ˜çï¼ ğŸ§§</div>
            <div class="marquee-content">ğŸ§§ è«‹æ‰¾å§‘å§‘é ˜çï¼ ğŸ§§</div>
        </div>
    </div>

    <div id="game-card" class="max-w-md w-full bg-red-luxury rounded-[3rem] p-10 text-white relative overflow-hidden shadow-2xl">
        
        <div class="absolute top-4 left-4 w-12 h-12 border-t-4 border-l-4 border-yellow-300 opacity-40"></div>
        <div class="absolute bottom-4 right-4 w-12 h-12 border-b-4 border-r-4 border-yellow-300 opacity-40"></div>

        <!-- 1. ä¸»é¸å–® -->
        <div id="screen-home" class="text-center relative z-10 py-6">
            <div class="text-8xl mb-6">ğŸ§§</div>
            <h1 class="text-6xl font-black mb-6 title-gold" style="font-family: 'Noto Serif TC', serif;">ç´…åŒ…å¤§æŒ‘æˆ°</h1>
            <p class="text-yellow-100 mb-12 leading-relaxed text-xl font-bold tracking-wide">é€£çºŒç­”å°å…­é“é—œå¡<br>å³å¯é ˜å–æ–°å¹´åˆ®åˆ®æ¨‚ï¼</p>
            
            <div class="space-y-6">
                <button onclick="startQuiz()" class="w-full btn-gold-3d font-black py-6 rounded-[2rem] text-3xl">
                    é–‹å§‹æŒ‘æˆ° ğŸ®
                </button>
                <button onclick="show('screen-claim')" class="w-full bg-white/10 border-2 border-yellow-500/50 text-yellow-200 font-bold py-4 rounded-[1.5rem] hover:bg-yellow-500/20 transition text-lg">
                    è¼¸å…¥æš—è™Ÿé ˜ç´…åŒ…
                </button>
            </div>
        </div>

        <!-- 2. æŒ‘æˆ°ç•«é¢ -->
        <div id="screen-quiz" class="hidden relative z-10">
            <div class="flex justify-between items-center mb-8">
                <button onclick="goHome()" class="flex items-center text-yellow-400 font-bold hover:text-white text-base">
                    ğŸ  é¦–é 
                </button>
                <div class="text-lg font-mono font-bold bg-black/40 px-4 py-1.5 rounded-full border-2 border-yellow-500/40">
                    <span id="step-num" class="text-yellow-400">1</span> / 6
                </div>
            </div>

            <div class="bg-black/30 p-6 rounded-[2rem] mb-8 border-2 border-yellow-500/30">
                <div id="quiz-tag" class="text-sm font-bold text-yellow-500 uppercase tracking-widest mb-3 text-center">âœ¦ æ–°æ˜¥æ™ºæ…§è€ƒé©— âœ¦</div>
                <h2 id="q-text" class="text-2xl font-bold leading-snug min-h-[80px] text-center text-white">å•é¡Œè¼‰å…¥ä¸­...</h2>
            </div>

            <div id="opt-container" class="grid gap-4"></div>

            <div class="w-full h-4 bg-red-900/50 mt-10 rounded-full overflow-hidden border-2 border-yellow-600/30">
                <div id="progress-bar" class="h-full bg-gradient-to-r from-yellow-700 via-yellow-400 to-yellow-200 transition-all duration-300" style="width: 16.6%"></div>
            </div>
        </div>

        <!-- 3. é€šé—œæˆåŠŸç•«é¢ -->
        <div id="screen-win" class="hidden text-center relative z-10 py-6">
            <div class="text-8xl mb-6">ğŸ†</div>
            <h1 class="text-5xl font-black mb-6 title-gold">å…¨èƒ½é€šé—œï¼</h1>
            <p class="text-yellow-100 mb-8 font-bold text-xl">æ‚¨çš„å°ˆå±¬é ˜çæš—è™Ÿï¼š</p>
            
            <div class="bg-black/40 rounded-[2rem] p-8 border-4 border-dashed border-yellow-400 mb-10 relative flex items-center justify-center">
                <button onclick="copyCode('win-code-display', this)" class="copy-btn absolute top-3 right-3" title="è¤‡è£½ä»£ç¢¼">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" class="text-yellow-400"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg>
                </button>
                <div id="win-code-display" class="text-6xl font-mono font-black tracking-widest text-white">----</div>
            </div>

            <button onclick="show('screen-claim')" class="w-full btn-gold-3d font-black py-6 rounded-[2rem] text-2xl">
                é ˜å–åˆ®åˆ®å¡ â”
            </button>
        </div>

        <!-- 3.5 å®‰æ…°çç•«é¢ -->
        <div id="screen-consolation-win" class="hidden text-center relative z-10 py-6">
            <div class="text-8xl mb-6">ğŸ§§</div>
            <h1 class="text-5xl font-black mb-6 title-gold">æ–°å¹´å¥½ç¦®ï¼</h1>
            <p class="text-yellow-100 mb-6 font-bold text-xl">è«‹è¨˜ä½æš—è™Ÿé ˜å–ï¼š</p>
            
            <div class="bg-black/40 rounded-[2rem] p-8 border-4 border-dashed border-yellow-400 mb-10 relative flex items-center justify-center">
                <button onclick="copyCode('consolation-code-display', this)" class="copy-btn absolute top-3 right-3" title="è¤‡è£½ä»£ç¢¼">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" class="text-yellow-400"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg>
                </button>
                <div id="consolation-code-display" class="text-5xl font-mono font-black tracking-widest text-white">----</div>
            </div>

            <button onclick="show('screen-claim')" class="w-full btn-gold-3d font-black py-6 rounded-[2rem] text-2xl">
                é ˜å–åˆ®åˆ®å¡ â”
            </button>
        </div>

        <!-- 4. è¼¸å…¥æš—è™Ÿé é¢ -->
        <div id="screen-claim" class="hidden relative z-10 text-center">
            <button onclick="goHome()" class="text-yellow-200 text-base mb-8 flex items-center mx-auto font-bold hover:text-white"> â® è¿”å›é¦–é  </button>
            <h2 class="text-4xl font-black mb-4 title-gold">é ˜å–ç´…åŒ…</h2>
            <p class="text-yellow-100 mb-10 font-bold text-lg text-center px-4">è«‹è¼¸å…¥æ­£ç¢ºæš—è™Ÿå•Ÿå‹•ï¼š</p>
            
            <div class="space-y-8">
                <input type="text" id="pass-input" placeholder="ä»£ç¢¼" class="w-full p-8 rounded-[2rem] bg-white/10 border-4 border-yellow-500/40 text-center text-5xl font-black tracking-[0.2em] focus:outline-none focus:border-yellow-400 uppercase text-white shadow-2xl">
                
                <button onclick="verifyPass()" class="w-full btn-gold-3d font-black py-6 rounded-[2rem] text-2xl">
                    é©—è­‰ä¸¦åˆ®é–‹ ğŸ§§
                </button>
                <p id="error-msg" class="text-yellow-400 font-bold hidden mt-4">âš  æš—è™Ÿä¸æ­£ç¢ºï¼è«‹é‡æ–°æŒ‘æˆ°ã€‚</p>
            </div>
        </div>

        <!-- 5. åˆ®åˆ®æ¨‚é é¢ -->
        <div id="screen-scratch" class="hidden relative z-10 py-4 text-center">
            <button onclick="goHome()" class="home-icon-btn" title="å›é¦–é ">
                <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path><polyline points="9 22 9 12 15 12 15 22"></polyline></svg>
            </button>

            <h2 class="text-4xl font-black mb-4 title-gold">æ–°å¹´å¥½æ‰‹æ°£</h2>
            <p class="text-yellow-100 mb-8 px-4 font-bold text-xl">è«‹ç”¨å°ç¡¬å¹£æ“¦å‡ºæ‚¨çš„çé‡‘é‡‘é¡ï¼š</p>
            
            <div class="scratch-container mb-12">
                <div id="amount-text" class="text-[#bd081c] text-7xl font-black tracking-tighter select-none">
                    $ 600
                </div>
                <canvas id="scratch-canvas" width="300" height="180"></canvas>
            </div>

            <div class="p-8 bg-black/30 rounded-[2rem] border-2 border-yellow-500/40 backdrop-blur-md">
                <p id="blessing-text" class="text-xl text-yellow-300 italic font-bold">æ­å–œä¸­çï¼Œé¾é¦¬ç²¾ç¥ï¼</p>
            </div>
        </div>

        <!-- 6. å¤±æ•—ç•«é¢ -->
        <div id="screen-fail" class="hidden text-center relative z-10 py-10">
            <div class="text-8xl mb-8">ğŸ˜…</div>
            <h1 class="text-4xl font-black mb-6 text-white">éºæ†¾ç­”éŒ¯äº†</h1>
            <p id="fail-desc" class="text-yellow-100 mb-12 font-bold text-lg leading-relaxed px-6">é¡Œç›®æ¯”è¼ƒé›£ï¼Œ<br>å†·éœæ€è€ƒä¸€ä¸‹å†æŒ‘æˆ°ï¼</p>
            
            <div id="consolation-block" class="hidden mb-10 p-8 bg-red-900/60 rounded-[2.5rem] border-4 border-dashed border-yellow-500">
                <p class="text-yellow-300 mb-4 font-black text-2xl">ğŸ§§ çå‹µä¸è½ç©º</p>
                <p class="text-white/90 mb-8 font-bold text-base">ç´¯è¨ˆå¤±æ•—å…©æ¬¡ï¼Œ<br>æ‚¨å¯ä»¥é¸æ“‡é ˜å–é©šå–œç´…åŒ…å–”ï¼</p>
                <button onclick="getConsolation()" class="w-full btn-gold-3d font-black py-5 rounded-2xl text-xl shadow-lg">ç›´æ¥é ˜å– â”</button>
            </div>

            <button onclick="goHome()" class="w-full bg-white/10 hover:bg-white/20 text-white font-bold py-6 rounded-[2rem] border-2 border-white/30 transition text-xl">
                é‡æ–°é–‹å§‹
            </button>
        </div>
    </div>

    <div id="toast" class="fixed bottom-10 left-1/2 -translate-x-1/2 bg-black/90 text-yellow-400 px-8 py-4 rounded-full text-lg font-bold shadow-2xl opacity-0 transition-opacity pointer-events-none z-[300]"></div>

    <script>
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        
        function playSuccessSound() {
            if (audioCtx.state === 'suspended') audioCtx.resume();
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.connect(gain); gain.connect(audioCtx.destination);
            osc.type = 'sine';
            osc.frequency.setValueAtTime(523.25, audioCtx.currentTime);
            osc.frequency.exponentialRampToValueAtTime(880, audioCtx.currentTime + 0.1);
            gain.gain.setValueAtTime(0.3, audioCtx.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.3);
            osc.start(); osc.stop(audioCtx.currentTime + 0.3);
        }

        function playFailSound() {
            if (audioCtx.state === 'suspended') audioCtx.resume();
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.connect(gain); gain.connect(audioCtx.destination);
            osc.type = 'sawtooth';
            osc.frequency.setValueAtTime(220, audioCtx.currentTime);
            osc.frequency.exponentialRampToValueAtTime(110, audioCtx.currentTime + 0.2);
            gain.gain.setValueAtTime(0.2, audioCtx.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.4);
            osc.start(); osc.stop(audioCtx.currentTime + 0.4);
        }

        function playCheerSound() {
            if (audioCtx.state === 'suspended') audioCtx.resume();
            const osc = audioCtx.createOscillator();
            const g = audioCtx.createGain();
            osc.type = 'sine';
            osc.frequency.setValueAtTime(300, audioCtx.currentTime);
            osc.frequency.exponentialRampToValueAtTime(600, audioCtx.currentTime + 0.5);
            g.gain.setValueAtTime(0.2, audioCtx.currentTime);
            g.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.8);
            osc.connect(g); g.connect(audioCtx.destination);
            osc.start(); osc.stop(audioCtx.currentTime + 0.8);
            for(let i=0; i<18; i++) {
                setTimeout(() => {
                    const bufferSize = audioCtx.sampleRate * 0.15;
                    const buffer = audioCtx.createBuffer(1, bufferSize, audioCtx.sampleRate);
                    const data = buffer.getChannelData(0);
                    for (let j = 0; j < bufferSize; j++) { data[j] = Math.random() * 2 - 1; }
                    const noise = audioCtx.createBufferSource();
                    noise.buffer = buffer;
                    const ng = audioCtx.createGain();
                    ng.gain.setValueAtTime(0.12, audioCtx.currentTime);
                    ng.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.12);
                    noise.connect(ng); ng.connect(audioCtx.destination);
                    noise.start(); noise.stop(audioCtx.currentTime + 0.15);
                }, i * 65 + Math.random()*45);
            }
        }

        function showToast(msg) {
            const t = document.getElementById('toast');
            t.innerText = msg; t.style.opacity = '1';
            setTimeout(() => { t.style.opacity = '0'; }, 2000);
        }

        const AUNT_BIRTHDAY_Q = { q: "è«‹å•ã€Œå§‘å§‘ã€çš„ç”Ÿæ—¥æ˜¯å¹¾æœˆå¹¾è™Ÿï¼Ÿ", a: ["11æœˆ22æ—¥", "10æœˆ22æ—¥", "11æœˆ12æ—¥", "12æœˆ22æ—¥"], c: 0 };
        const POOL_BIRTHDAY = [
            { q: "è«‹å•ã€Œé˜¿å…¬ã€çš„ç”Ÿæ—¥æ˜¯å¹¾æœˆå¹¾è™Ÿï¼Ÿ", a: ["1æœˆ10æ—¥", "1æœˆ20æ—¥", "2æœˆ20æ—¥", "12æœˆ20æ—¥"], c: 1 },
            { q: "è«‹å•ã€Œé˜¿å¬¤ã€çš„ç”Ÿæ—¥æ˜¯å¹¾æœˆå¹¾è™Ÿï¼Ÿ", a: ["11æœˆ20æ—¥", "11æœˆ26æ—¥", "10æœˆ26æ—¥", "12æœˆ26æ—¥"], c: 1 }
        ];
        const POOL_TAIWAN_HARD = [
            { q: "å°å—ã€Œé¹½æ°´ã€åœ°å€ä»¥å“ªä¸€å€‹æ°‘ä¿—æ´»å‹•èååœ‹éš›ï¼Ÿ", a: ["é¹½æ°´èœ‚ç‚®", "è¬é‡‘è–èª•", "ä¸­å°ç£å…ƒå®µ", "å®œè˜­æ¶å­¤"], c: 0 },
            { q: "é«˜é›„ã€Œç¾æ¿ƒã€åœ°å€æœ€è‘—åçš„å‚³çµ±ç²¾ç·»å·¥è—æ˜¯ä»€éº¼ï¼Ÿ", a: ["æ²¹ç´™å‚˜", "ç«¹ç·¨ç±ƒ", "é™¶è—å“", "æ¼†å™¨å·¥è—"], c: 0 },
            { q: "å“ªä¸€å€‹ç¸£å¸‚è¢«è­½ç‚ºå°ç£æœ€é‡è¦çš„ã€Œè˜­èŠ±ä¹‹é„‰ã€ï¼Ÿ", a: ["å°å—å¸‚", "å±æ±ç¸£", "å—æŠ•ç¸£", "å®œè˜­ç¸£"], c: 0 },
            { q: "æ–°ç«¹ã€Œå…§ç£ã€è€è¡—éå»æ˜¯å› ç‚ºå“ªå…©å¤§ç”¢æ¥­è€Œç™¼é”ï¼Ÿ", a: ["ç¤¦æ¥­èˆ‡æ—æ¥­", "èŒ¶ç”¢æ¥­", "æ¼æ¥­", "é¹½æ¥­"], c: 0 },
            { q: "å®œè˜­ã€Œä¸‰æ˜Ÿã€åœ°å€é™¤äº†é’è”¥ï¼Œé‚„æœ‰å“ªç¨®æ¢¨å­èåï¼Ÿ", a: ["ä¸Šå°‡æ¢¨", "è“®éœ§æ¢¨", "äºŒåä¸–ç´€æ¢¨", "æ°´èœœæ¢¨"], c: 0 },
            { q: "å±æ±ã€Œæ±æ¸¯ã€ä¸‰å¯¶é™¤äº†é®ªé­šèˆ‡æ«»èŠ±è¦ï¼Œé‚„æœ‰ï¼Ÿ", a: ["æ²¹é­šå­", "çƒé­šå­", "é­šé¬†", "é»‘è¼ª"], c: 0 }
        ];
        const POOL_ENGLISH_HARD = [
            { q: "How long ___ you lived in Taiwan?", a: ["have", "did", "are", "do"], c: 0 },
            { q: "I'm looking forward ___ seeing you soon.", a: ["to", "at", "for", "with"], c: 0 },
            { q: "If it ___ tomorrow, we will stay at home.", a: ["rains", "rain", "will rain", "rained"], c: 0 },
            { q: "He is the ___ intelligent student I know.", a: ["most", "more", "best", "very"], c: 0 },
            { q: "The English word 'Prosperity' means:", a: ["ç¹æ¦®èˆˆæ—º", "è²§çª®å›°è‹¦", "ç½é›£é™è‡¨", "å®‰éœå¹³åº¸"], c: 0 }
        ];

        let currentQuiz = [];
        let currentIdx = 0;
        let failCount = 0;
        let activeCode = ""; 
        let activeAmount = 600; 

        function show(id) {
            ['screen-home', 'screen-quiz', 'screen-win', 'screen-fail', 'screen-claim', 'screen-scratch', 'screen-consolation-win'].forEach(s => {
                document.getElementById(s).classList.add('hidden');
            });
            document.getElementById(id).classList.remove('hidden');
        }

        function generateCode() { return Math.random().toString(36).substring(2, 6).toUpperCase(); }

        function copyCode(elementId, btn) {
            const code = document.getElementById(elementId).innerText;
            const temp = document.createElement("input");
            temp.value = code; document.body.appendChild(temp);
            temp.select(); 
            try { document.execCommand("copy"); showToast("ä»£ç¢¼å·²è¤‡è£½ï¼"); } catch (err) { showToast("è«‹æ‰‹å‹•è¤‡è£½"); }
            document.body.removeChild(temp);
        }

        function startQuiz() {
            currentIdx = 0; activeAmount = 600; activeCode = generateCode();
            const family = [AUNT_BIRTHDAY_Q, ...POOL_BIRTHDAY.sort(() => Math.random() - 0.5).slice(0, 1)];
            const taiwan = [...POOL_TAIWAN_HARD].sort(() => Math.random() - 0.5).slice(0, 2);
            const english = [...POOL_ENGLISH_HARD].sort(() => Math.random() - 0.5).slice(0, 2);
            currentQuiz = [...family, ...taiwan, ...english].sort(() => Math.random() - 0.5);
            show('screen-quiz'); renderQ();
        }

        function renderQ() {
            const data = currentQuiz[currentIdx];
            document.getElementById('step-num').innerText = currentIdx + 1;
            document.getElementById('q-text').innerText = data.q;
            document.getElementById('progress-bar').style.width = `${((currentIdx + 1) / 6) * 100}%`;
            const container = document.getElementById('opt-container');
            container.innerHTML = '';
            data.a.forEach((txt, i) => {
                const b = document.createElement('button');
                b.className = "w-full text-left bg-white/10 hover:bg-white/20 p-4 px-6 rounded-[1.5rem] border-2 border-white/20 transition active:scale-95 font-bold text-lg shadow-md";
                b.innerText = txt;
                b.onclick = () => handleAnswer(i);
                container.appendChild(b);
            });
        }

        function handleAnswer(i) {
            if (i === currentQuiz[currentIdx].c) {
                playSuccessSound();
                currentIdx++;
                if (currentIdx >= 6) { document.getElementById('win-code-display').innerText = activeCode; show('screen-win'); } else { renderQ(); }
            } else {
                playFailSound(); failCount++;
                const q = currentQuiz[currentIdx].q;
                let msg = "ç­”éŒ¯å›‰ï¼é¡Œç›®æ¯”è¼ƒæ·±å¥§ã€‚";
                if (q.includes("å§‘å§‘") || q.includes("é˜¿å…¬") || q.includes("é˜¿å¬¤")) msg = "è¦ªäººçš„ç”Ÿæ—¥è¦ç”¨å¿ƒè¨˜ä½å–”ï¼";
                document.getElementById('fail-desc').innerText = msg;
                if (failCount >= 2) document.getElementById('consolation-block').classList.remove('hidden');
                show('screen-fail');
            }
        }

        function getConsolation() {
            activeAmount = 1; activeCode = "TRY" + Math.floor(Math.random()*90 + 10);
            document.getElementById('consolation-code-display').innerText = activeCode;
            show('screen-consolation-win'); 
        }

        function verifyPass() {
            const input = document.getElementById('pass-input').value.trim().toUpperCase();
            if (input === activeCode) { document.getElementById('error-msg').classList.add('hidden'); initScratch(activeAmount); show('screen-scratch'); } else { document.getElementById('error-msg').classList.remove('hidden'); }
        }

        function initScratch(amount) {
            document.getElementById('amount-text').innerText = "$ " + amount;
            document.getElementById('blessing-text').innerText = amount > 1 ? "æ­å–œä¸­çï¼Œé¾é¦¬ç²¾ç¥ï¼" : "é›–ç„¶æ˜¯å°ç¦®ï¼Œä½†ä¹Ÿä»£è¡¨æ»¿æ»¿ç¥ç¦å–”ï¼";

            const canvas = document.getElementById('scratch-canvas');
            const ctx = canvas.getContext('2d');
            const w = canvas.width; const h = canvas.height;

            ctx.globalCompositeOperation = 'source-over';
            const grad = ctx.createLinearGradient(0,0,w,h);
            grad.addColorStop(0, '#d4af37'); grad.addColorStop(0.3, '#f6e05e'); grad.addColorStop(0.7, '#f6e05e'); grad.addColorStop(1, '#b8860b');
            ctx.fillStyle = grad; ctx.fillRect(0, 0, w, h);
            
            ctx.fillStyle = 'rgba(0, 0, 0, 0.1)';
            for(let i=0; i<450; i++) ctx.fillRect(Math.random()*w, Math.random()*h, 1, 1);

            ctx.shadowColor = "rgba(0, 0, 0, 0.5)"; ctx.shadowBlur = 5;
            ctx.fillStyle = '#5d0a0a'; 
            ctx.font = '900 42px Noto Sans TC'; ctx.textAlign = 'center';
            ctx.fillText('é¦¬åˆ°æˆåŠŸ ğŸ§§', w/2, h/2 - 10);
            ctx.font = '900 26px Noto Sans TC';
            ctx.fillText('é¾é¦¬ç²¾ç¥ æ“¦å‡ºå¥½é‹', w/2, h/2 + 45);
            ctx.shadowBlur = 0;

            let isDrawing = false;
            let lastX = 0, lastY = 0;

            // ç¹ªè£½è‡ªå®šç¾©é‡‘å¹£åœ–æ¨™
            function drawCoin(x, y) {
                const tempCanvas = document.createElement('canvas');
                tempCanvas.width = 40; tempCanvas.height = 40;
                const tctx = tempCanvas.getContext('2d');
                
                tctx.beginPath();
                tctx.arc(20, 20, 18, 0, Math.PI*2);
                tctx.fillStyle = '#f6e05e'; tctx.fill();
                tctx.strokeStyle = '#b8860b'; tctx.lineWidth = 2; tctx.stroke();
                
                tctx.fillStyle = '#b8860b'; tctx.font = 'bold 16px serif'; tctx.textAlign = 'center'; tctx.textBaseline = 'middle';
                tctx.fillText('è²¡', 20, 21);
                
                return tempCanvas;
            }

            const coinImg = drawCoin();

            function scratch(x, y, isFirst) {
                ctx.globalCompositeOperation = 'destination-out';
                ctx.lineWidth = 14; 
                ctx.lineCap = 'round'; ctx.lineJoin = 'round';
                ctx.beginPath();
                if (isFirst) { ctx.moveTo(x, y); } else { ctx.moveTo(lastX, lastY); }
                ctx.lineTo(x, y); ctx.stroke();
                lastX = x; lastY = y;
            }

            const getPos = (e) => {
                const rect = canvas.getBoundingClientRect();
                const clientX = e.touches ? e.touches[0].clientX : e.clientX;
                const clientY = e.touches ? e.touches[0].clientY : e.clientY;
                return { x: clientX - rect.left, y: clientY - rect.top };
            };

            const startAction = (e) => { isDrawing = true; const p = getPos(e); scratch(p.x, p.y, true); };
            const moveAction = (e) => { 
                if(!isDrawing) return; 
                e.preventDefault(); 
                const p = getPos(e); 
                scratch(p.x, p.y, false); 
            };
            const endAction = () => { if(isDrawing) { isDrawing = false; launchFinish(); } };

            canvas.onmousedown = startAction;
            window.onmousemove = moveAction;
            window.onmouseup = endAction;
            canvas.ontouchstart = startAction;
            canvas.ontouchmove = moveAction;
            canvas.ontouchend = endAction;
        }

        function goHome() { 
            document.getElementById('pass-input').value = "";
            document.getElementById('reward-notice').classList.add('hidden');
            show('screen-home'); 
        }

        function launchFinish() {
            playCheerSound();
            document.getElementById('reward-notice').classList.remove('hidden');
            for (let i = 0; i < 60; i++) {
                const c = document.createElement('div');
                c.className = 'confetti';
                c.style.left = Math.random() * 100 + 'vw';
                c.style.backgroundColor = ['#fbbf24', '#ffffff', '#f87171', '#fb923c', '#d42424'][Math.floor(Math.random()*5)];
                document.body.appendChild(c);
                c.animate([{ transform: 'translateY(0) rotate(0)', opacity: 1 }, { transform: `translateY(100vh) translateX(${Math.random()*60-30}px) rotate(${Math.random()*360}deg)`, opacity: 0 }], { duration: 2500 }).onfinish = () => c.remove();
            }
        }
    </script>
</body>
</html>
